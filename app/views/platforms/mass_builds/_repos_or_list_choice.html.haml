%h3=t("layout.mass_builds.repositories")
-@platform.repositories.each do |rep|
  .both
    =check_box_tag "repositories[]", rep.id, (params[:repositories]||[]).include?(rep.id.to_s), :id => "repositories_#{rep.id}", :href => "#{projects_list_platform_repository_path(@platform, rep)}?text=true"
    =label_tag "repositories_#{rep.id}", rep.name
%h3=t("layout.mass_builds.projects_list")
=text_area_tag :projects_list, nil
:javascript
  $(document).ready(function() {
    var projects_list = $('.form.mass_build #projects_list');
    var repositories = $(".form.mass_build input:checkbox");
    repositories.click(function(){
      if (this.checked){
        $(this).attr('disabled',true);
        $.ajax({
          type: 'GET',
          url: $(this).attr('href'),
          success: function(data){
                     var text = projects_list.val();
                     if(text.length > 0 && text.slice(-1) != '\n') {text = text + "\n"}
                     projects_list.val(text+data);
                   },
          error: function(data){
                   alert('Error :(') // TODO remove
                 }
        });
      }
      return true;
    });

    projects_list.keyup(function(){
      if($(this).val().length == 0) {
        repositories.attr('disabled',false)
                    .attr('checked', false);
      }
    });
  });
