-begin
  =render_diff_stats(@project.repo.diff_stats @commit1.id, @commit.id)
  = "#{@commit1}...#{@commit}"
  =#render :partial => 'commit_diff', :collection => @project.repo.diff(@commit1.id, @commit.id)
  -@project.repo.diff(@commit1.id, @commit.id).each_with_index do |commit_diff, diff_counter|
    - commit_id = commit_diff.deleted_file ? @common_ancestor.id : @commit.id
    .file
      %a{:name => "diff-#{diff_counter}"}
      .top
        .l= h(commit_diff.a_path.rtruncate 120)
        - if commit_diff.b_path.present?
          .r= link_to "view file @ #{short_hash_id(commit_id)}", blob_path(@project, commit_id, commit_diff.b_path)
        .clear
      -if commit_diff.diff.present? && !(@project.repo.tree(commit_id) / commit_diff.b_path).binary?
        .diff_data=render_diff(commit_diff, :diff_counter => diff_counter)
- rescue Grit::Git::GitTimeout
  %p= t 'layout.git.repositories.commit_diff_too_big'
