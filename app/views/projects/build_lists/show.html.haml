-set_meta_tags :title => [title_object(@build_list.project), t('activerecord.models.build_list')]
.notify.blue
  %div{:class => build_list_status_color(@build_list.status)}
    %p= @build_list.human_status
  %p= @build_list.updated_at
  .both
= form_for @build_list do |f|
  %h3= t("layout.build_lists.main_data")
  .leftlist= t("activerecord.attributes.build_list.container_path")
  .rightlist
    - if @build_list.status == BuildList::BUILD_PUBLISHED
      = t("layout.build_lists.container_published")
    - elsif @build_list.container_path.present?
      - container_url = "http://#{request.host_with_port}/downloads#{@build_list.container_path}"
      = link_to container_url, container_url
  .both

  .leftlist= t("activerecord.attributes.build_list.bs_id")
  .rightlist= @build_list.bs_id.present? ? @build_list.bs_id : t("layout.build_lists.bs_id_not_set")
  .both
  .leftlist= t("activerecord.attributes.build_list.user")
  .rightlist
    = link_to @build_list.user.try(:fullname), @build_list.user
  .both
  .leftlist= t("activerecord.attributes.build_list.build_for_platform")
  .rightlist
    = link_to @build_list.build_for_platform.name, @build_list.build_for_platform
  .both
  .leftlist= t("activerecord.attributes.build_list.save_to_platform")
  .rightlist
    = link_to @build_list.save_to_platform.name, @build_list.save_to_platform
  .both
  .leftlist= t("activerecord.attributes.build_list.include_repos")
  .rightlist= (@build_list.include_repos||[]).map{|r| Repository.find(r).name}.join(', ')
  .both
  .leftlist= t("activerecord.attributes.build_list.update_type")
  .rightlist
    - if @build_list.can_publish? && can?(:publish, @build_list)
      = f.select :update_type, options_for_select(build_list_classified_update_types, @build_list.update_type)
    - else
      = @build_list.update_type
  .both
  .leftlist= t("activerecord.attributes.build_list.build_requires")
  .rightlist= t("layout.#{@build_list.build_requires}_")
  .both
  .leftlist= t("activerecord.attributes.build_list.auto_publish")
  .rightlist= t("layout.#{@build_list.auto_publish}_")
  .both
  .leftlist= t("activerecord.attributes.build_list.project_version")
  .rightlist= build_list_version_link(@build_list, true)
  .both
  .leftlist= t("activerecord.attributes.build_list.arch")
  .rightlist= @build_list.arch.name
  .both
  .leftlist= t("activerecord.attributes.build_list.updated_at")
  .rightlist= @build_list.updated_at
  .both
  .leftlist= t("activerecord.attributes.build_list.is_circle")
  .rightlist= t("layout.#{@build_list.is_circle?}_")
  .both

  - if @build_list.mass_build_id.present?
    .leftlist= t("activerecord.attributes.mass_build_id")
    .rightlist= link_to @build_list.mass_build.name, platform_mass_builds_path(@build_list.save_to_platform)
    .both


  - if @build_list.advisory.present?
    .leftlist= t("layout.build_lists.attached_advisory")
    .rightlist= link_to @build_list.advisory.advisory_id, advisory_path(@build_list.advisory)
    .both
  - if !@build_list.in_work? && @build_list.started_at
    %br
    .leftlist
    .rightlist= @build_list.human_duration
    .both
  - if @build_list.in_work?
    %br
    .leftlist
    .rightlist
      = "#{@build_list.human_current_duration} / #{@build_list.project.human_average_build_time}"
    .both

  - if @build_list.can_cancel? && can?(:cancel, @build_list)
    = link_to t("layout.build_lists.cancel"), cancel_build_list_path(@build_list),
              :method => :put, :confirm => t("layout.confirm"), :class => 'button'

  - if @build_list.can_publish? && @build_list.save_to_platform.released && @build_list.advisory.nil? && can?(:publish, @build_list)
    #advisory_block
      .leftlist= label_tag :attach_advisory, t("layout.build_lists.attached_advisory")
      .rightlist
        = select_tag :attach_advisory, advisories_select_options(@advisories)
        %p.hint_text= t("layout.advisories.publication_info", :update_types => BuildList::RELEASE_UPDATE_TYPES.join(', '))
      .both

      #advisory_search_block
        %h3= t("layout.advisories.search_by_id")
        .leftlist= label_tag :advisory_search, t("layout.advisories.search_hint")
        .rightlist
          %input#advisory_search{:type => 'text'}
          %p.hint_text= t("layout.advisories.advisory_id_info", :advisory_format => advisory_id_for_hint)
        .both
        - %w(advisory_not_found server_error continue_input).each do |el|
          .info{:class => el}
            %p= t("layout.advisories.banners.#{el}")

      #new_advisory_form
        = f.fields_for @build_list.build_advisory do |f|
          = render :partial => 'advisories/form', :locals => {:f => f}

      #advisory_preview
        %h3= t("activerecord.models.advisory") << ' '

        .leftlist= t("activerecord.attributes.advisory.description")
        .rightlist.descr &nbsp;
        .both

        .leftlist= t("activerecord.attributes.advisory.references")
        .rightlist.refs &nbsp;
        .both
    :javascript
      $(function() {
        var r = new Rosa.Routers.BuildListsAdvisoriesRouter();
      });

  = submit_tag t("layout.publish"), :confirm => t("layout.confirm"), :name => 'publish' if @build_list.can_publish? && can?(:publish, @build_list)
  = submit_tag t("layout.reject_publish"), :confirm => t("layout.confirm"), :name => 'reject_publish' if @build_list.can_reject_publish? && can?(:reject_publish, @build_list)

.hr
%h3= t("layout.build_lists.items_header")
- if @item_groups.blank?
  %h4.nomargin= t("layout.build_lists.no_items_data")
- @item_groups.each_with_index do |group, level|
  - group.each do |item|
    %h4.nomargin= "#{item.name} ##{level}"
    %table.tablesorter.width565{:cellpadding => "0", :cellspacing => "0"}
      %thead
        %tr
          %th= t("activerecord.attributes.build_list/item.name")
          %th= t("activerecord.attributes.build_list/item.version")
          %th= t("activerecord.attributes.build_list/item.status")
      %tbody
        %tr{:class => build_list_item_status_color(item.status)}
          %td= item.name
          %td= item.version
          %td= item.human_status
.both

- if @build_list.packages.present?
  .hr
  %h3= t("layout.build_lists.packages_header")
  %table.tablesorter.width565{:cellpadding => "0", :cellspacing => "0"}
    %thead
      %tr
        %th= t("activerecord.attributes.build_list/package.fullname")
        %th= t("activerecord.attributes.build_list/package.name")
        %th= t("activerecord.attributes.build_list/package.version")
        %th= t("activerecord.attributes.build_list/package.release")
    %tbody
      - @build_list.packages.each do |package|
        %tr
          %td= package.fullname
          %td= package.name
          %td= package.version
          %td= package.release
  .both

:javascript
  $('article .all').addClass('bigpadding');

= render 'submenu'
