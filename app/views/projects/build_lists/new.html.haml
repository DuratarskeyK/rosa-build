-set_meta_tags :title => [title_object(@project), t('layout.build_lists.new_header')]
= form_for [@project, @build_list], :html => { :class => :form, :method => :post } do |f|
  %section.left
    %h3= t("activerecord.attributes.build_list.build_for_platform")
    .all_platforms
      - Platform.main.each do |pl|
        - if pl.repository_ids.size > 0
          .both
            =# check_box_tag "build_for_platforms[]", pl.id, (params[:build_for_platforms]||[]).include?(pl.id.to_s), :class => 'build_bpl_ids', :id => "bpls_#{pl.id}"
            =# label_tag "bpls_#{pl.id}", pl.name
            %div{:id => "build_for_pl_#{pl.id}", :class => 'build_for_pl'}= pl.name
            .offset25= render 'include_repos', :platform => pl
  %section.right
    %h3= t("activerecord.attributes.build_list.save_to_repository")
    .lineForm= f.select :save_to_repository_id, @project.repositories.collect{|r| ["#{r.platform.name}/#{r.name}", r.id, {:publish_without_qa => r.publish_without_qa? ? 1 : 0, :platform_id => r.platform.id}]}
    %h3= t("activerecord.attributes.build_list.project_version")
    .lineForm= f.select :project_version, versions_for_group_select(@project), :selected => params[:build_list].try(:fetch, :project_version) || @project.default_branch
    %h3= t("activerecord.attributes.build_list.arch")
    - Arch.recent.each do |arch|
      .both
        = check_box_tag "arches[]", arch.id, (params[:arches]||[]).include?(arch.id.to_s) || controller.action_name == 'new', :id => "arches_#{arch.id}"
        = label_tag "arches_#{arch.id}", arch.name
    %h3= t("activerecord.attributes.build_list.update_type")
    .lineForm= f.select :update_type, BuildList::UPDATE_TYPES



    #extra-repos-and-containers
      %h3= t("activerecord.attributes.build_list.extra_repos")
      = autocomplete_field_tag 'extra_repos', nil, autocomplete_to_extra_repos_and_containers_build_lists_path, :id_element => '#extra_repo_field'
      = hidden_field_tag 'extra_repo', nil, :id => 'extra_repo_field'
      = submit_tag t("layout.add"), :class => 'button', :id => 'add'
      %table.tablesorter{:cellpadding => "0", :cellspacing => "0"}
        %tbody
          - Repository.where(id: @build_list.extra_repositories).each do |repo|
            = render 'extra', :subject => repo

          - BuildList.where(id: @build_list.extra_containers).each do |bl|
            = render 'extra', :subject => bl

    %h3= t("activerecord.attributes.build_list.preferences")
    - [:auto_publish, :auto_create_container, :use_save_to_repository].each do |kind|
      .both
        = f.check_box kind
        = f.label kind
    %br
    = f.submit t("layout.projects.build_button")

= render 'projects/base/submenu'
